
template:
  # - binary_sensor:
  #     - name: Open windows
  #       state: >
  #         {{ states 
  #           | sellectattr('attributes.device_class', 'eq', 'window') 
  #           | map(attribute='state') 
  #           | select('eq', 'on') 
  #           | list | count > 0 
  #         }}
  #       attributes:
  #         windows: >
  #           {% set ns = namespace(windows = []) %}
  #           {%- for item in states | selectattr('attributes.device_class', 'eq', 'window') -%}
  #             {%- if item.state == 'on' -%}
  #               {% set ns.windows + [item.attributes.friendly_name] %}
  #             {%- endif _%}
  #           {%- endfor -%}
  #           {{ ns.windows }}

# eu asa as face 
  - trigger:
      - platform: time_pattern
        minutes: "/1"
    sensor:
      - name: "Open Windows"
        icon: "hass:window-open"
        state: >
              {{ states
                |selectattr('attributes.device_class','eq','window')
                |rejectattr('state', 'in', ['off','unknown','unavailable','none'])
                |rejectattr('entity_id','in',state_attr('group.ignored_updates','entity_id'))
                |list|count 
              }}
        attributes:
            names: >
              {{ states
                |selectattr('attributes.device_class','eq','window')
                |rejectattr('state', 'in', ['off','unknown','unavailable','none'])
                |rejectattr('entity_id','in',state_attr('group.ignored_updates','entity_id'))
                |map(attribute='name')|join (", ")
              }}