template:
  - trigger:
      - platform: time_pattern
        minutes: "/1"
    sensor:
      - name: "Low Batteries"
        icon: "hass:battery-alert-variant-outline"
        state: >
              {% set threshold = 50 %}
              {% set result = namespace(sensors=[]) %}
              {% for state in states.sensor | selectattr('attributes.device_class', '==', 'battery')
                |rejectattr('entity_id','in',state_attr('group.ignored_entities','entity_id')) %}
                {% if 0 <= state.state | int(-1) < threshold | int  %}
                  {% set result.sensors = result.sensors + [state.name ~ ' (' ~ state.state ~ ' %)'] %}
                {% endif %}
              {% endfor %}
              {{ result.sensors|count }}
        attributes:
            names: >
              {% set threshold = 50 %}
              {% set result = namespace(sensors=[]) %}
              {% for state in states.sensor | selectattr('attributes.device_class', '==', 'battery')
                |rejectattr('entity_id','in',state_attr('group.ignored_entities','entity_id')) %}
                {% if 0 <= state.state | int(-1) < threshold | int  %}
                  {% set result.sensors = result.sensors + [state.name ~ ' (' ~ state.state ~ ' %)'] %}
                {% endif %}
              {% endfor %}
              {{ result.sensors|join (', ') }}